<!DOCTYPE html>



  


<html class="theme-next pisces use-motion" lang="zh-tw">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="Hexo, NexT" />










<meta name="description" content="Android Studio 環境配置 Android 6.0 minSdkVersion 21 targetSdkVersion 27 Language：Kotlin 第三方使用套件：無  程度需求 對 kotlin 有一定程度了解 對 Android 客製化 UI 有基礎認識  完成效果廢話不多說，先看個效果，來了解一下我們會做出什麼東西來！">
<meta property="og:type" content="article">
<meta property="og:title" content="客製化音量偵測UI！ UIVolumeView 全實作紀錄">
<meta property="og:url" content="http://yoursite.com/2018/08/16/UIVolumeView/index.html">
<meta property="og:site_name" content="Lex&#39;s Vision">
<meta property="og:description" content="Android Studio 環境配置 Android 6.0 minSdkVersion 21 targetSdkVersion 27 Language：Kotlin 第三方使用套件：無  程度需求 對 kotlin 有一定程度了解 對 Android 客製化 UI 有基礎認識  完成效果廢話不多說，先看個效果，來了解一下我們會做出什麼東西來！">
<meta property="og:locale" content="zh-tw">
<meta property="og:image" content="http://yoursite.com/2018/08/16/UIVolumeView/sample.gif">
<meta property="og:image" content="http://yoursite.com/2018/08/16/UIVolumeView/layout1.png">
<meta property="og:image" content="http://yoursite.com/2018/08/16/UIVolumeView/layout2.png">
<meta property="og:image" content="http://yoursite.com/2018/08/16/UIVolumeView/layout4.png">
<meta property="og:image" content="http://yoursite.com/2018/08/16/UIVolumeView/layout5.png">
<meta property="og:image" content="http://yoursite.com/2018/08/16/UIVolumeView/layout3.png">
<meta property="og:image" content="http://yoursite.com/2018/08/16/UIVolumeView/full.png">
<meta property="og:image" content="http://yoursite.com/2018/08/16/UIVolumeView/Flow.png">
<meta property="og:image" content="http://yoursite.com/2018/08/16/UIVolumeView/full_detail.png">
<meta property="og:image" content="http://yoursite.com/2018/08/16/UIVolumeView/Flow2.png">
<meta property="og:image" content="http://yoursite.com/2018/08/16/UIVolumeView/layout1.png">
<meta property="og:image" content="http://yoursite.com/2018/08/16/UIVolumeView/Shape.png">
<meta property="og:image" content="http://yoursite.com/2018/08/16/UIVolumeView/Shape2.png">
<meta property="og:updated_time" content="2018-08-30T08:07:10.298Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="客製化音量偵測UI！ UIVolumeView 全實作紀錄">
<meta name="twitter:description" content="Android Studio 環境配置 Android 6.0 minSdkVersion 21 targetSdkVersion 27 Language：Kotlin 第三方使用套件：無  程度需求 對 kotlin 有一定程度了解 對 Android 客製化 UI 有基礎認識  完成效果廢話不多說，先看個效果，來了解一下我們會做出什麼東西來！">
<meta name="twitter:image" content="http://yoursite.com/2018/08/16/UIVolumeView/sample.gif">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/2018/08/16/UIVolumeView/"/>





  <title>客製化音量偵測UI！ UIVolumeView 全實作紀錄 | Lex's Vision</title>
  








</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-tw">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Lex's Vision</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首頁
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分類
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            歸檔
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/08/16/UIVolumeView/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Lex">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Lex's Vision">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">客製化音量偵測UI！ UIVolumeView 全實作紀錄</h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">發表於</span>
              
              <time title="創建於" itemprop="dateCreated datePublished" datetime="2018-08-16T12:51:59+08:00">
                2018-08-16
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分類於</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Android/" itemprop="url" rel="index">
                    <span itemprop="name">Android</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          
            <span class="post-meta-divider">|</span>
            <span class="page-pv"><i class="fa fa-file-o"></i>
            <span class="busuanzi-value" id="busuanzi_value_page_pv" ></span>
            </span>
          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <h2 id="Android-Studio-環境配置"><a href="#Android-Studio-環境配置" class="headerlink" title="Android Studio 環境配置"></a>Android Studio 環境配置</h2><ul>
<li>Android 6.0</li>
<li>minSdkVersion 21</li>
<li>targetSdkVersion 27</li>
<li>Language：Kotlin</li>
<li>第三方使用套件：無</li>
</ul>
<h2 id="程度需求"><a href="#程度需求" class="headerlink" title="程度需求"></a>程度需求</h2><ul>
<li>對 kotlin 有一定程度了解</li>
<li>對 Android 客製化 UI 有基礎認識</li>
</ul>
<h2 id="完成效果"><a href="#完成效果" class="headerlink" title="完成效果"></a>完成效果</h2><p>廢話不多說，先看個效果，來了解一下我們會做出什麼東西來！</p>
<img src="/2018/08/16/UIVolumeView/sample.gif" title="Sample">
<a id="more"></a>
<h2 id="正式開始"><a href="#正式開始" class="headerlink" title="正式開始"></a>正式開始</h2><h3 id="開始吧！-首先："><a href="#開始吧！-首先：" class="headerlink" title="開始吧！ 首先："></a>開始吧！ 首先：</h3><p>建立class 繼承 View，並依照規範將三個需要實作的建構子一起建立出來(我的習慣是使用constructor)</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">UIVolumeView</span> : <span class="type">View &#123;</span></span></span><br><span class="line"> 	<span class="keyword">constructor</span>(context: Context?) : <span class="keyword">super</span>(context)</span><br><span class="line"></span><br><span class="line">   	<span class="keyword">constructor</span>(context: Context?, attrs: AttributeSet?) : <span class="keyword">super</span>(context, attrs)</span><br><span class="line"></span><br><span class="line">   	<span class="keyword">constructor</span>(context: Context?, attrs: AttributeSet?, defStyleAttr: <span class="built_in">Int</span>) : <span class="keyword">super</span>(context, attrs, defStyleAttr)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>繼承 View 要實作的細節和流程就不再多敘述，這裡僅實作onDraw方法，請先將 <span style="color:blue"> onDraw </span> 方法覆寫</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onDraw</span><span class="params">(canvas: <span class="type">Canvas</span>?)</span></span> &#123;</span><br><span class="line">	<span class="keyword">super</span>.onDraw(canvas)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>然後建立兩個 class member，用處之後說明：</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">UIVolumeView</span> : <span class="type">View &#123;</span></span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">val</span> paint = Paint()</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">val</span> path = Path()</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">constructor</span>(context: Context?) : <span class="keyword">super</span>(context)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">constructor</span>(context: Context?, attrs: AttributeSet?) : <span class="keyword">super</span>(context, attrs)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">constructor</span>(context: Context?, attrs: AttributeSet?, defStyleAttr: <span class="built_in">Int</span>) : <span class="keyword">super</span>(context, attrs, defStyleAttr)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onDraw</span><span class="params">(canvas: <span class="type">Canvas</span>?)</span></span> &#123;</span><br><span class="line">    	<span class="keyword">super</span>.onDraw(canvas)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>以上是最後完成的程式碼，build之後沒有錯誤的話，就成功了第一步</p>
<h2 id="UI-設計概念"><a href="#UI-設計概念" class="headerlink" title="UI 設計概念"></a>UI 設計概念</h2><h3 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h3><p>再談設計概念之前，先來看一下這張完成圖片，相信有開發經驗的工程師們，一定都會得到UI/UX 設計師給的設計稿或切圖，以下這張圖應該算是張元件的完成圖：</p>
<p><img src="layout1.png" alt=""></p>
<p>當得到一張元件圖之後，就得要開始思考，怎麼樣做出這個元件，怎麼樣能夠真正呈現在手機上又能符合設計師要的動畫效果。</p>
<p>其實做法有很多種，我當初也想了幾個方式來做決定：</p>
<ol><br><li>使用 LevelListDrawable，設置總共25張圖片，分25個等級去置換</li><br><li>繼承 ProgressBar 客製化</li><br><li>繼承 View，自己用 Canvas 實作</li><br></ol>

<p>第一個方法，比較快速簡單，但是要切25張圖，我不會切，而且這個也不是公司案子，是不能動用設計師的，所以沒採用。</p>
<p>第二個方法，沒有找到如何客製化 ProgressBar 的最佳方式，試了很久還是不成功，放棄。</p>
<p>最後只剩第三個方法，老實說我真的滿懶得，所以第三個方法不到最後不做，因為這真的很難做R～～</p>
<h3 id="分析"><a href="#分析" class="headerlink" title="分析"></a>分析</h3><p>既然選擇第三個方式，那就開始分析吧！ 我個人分析的習慣都是從大到小、外往內、上往下的概念分析：</p>
<ul>
<li>圖層 (外往內分析)：<ol>
<li>整個畫布：<img src="layout2.png" alt=""></li>
<li>三角形裁減區塊（之後說明）：<img src="layout4.png" alt=""></li>
<li>底部刻度圖：<img src="layout5.png" alt=""></li>
<li>最後一張上面所說的，兩個元件疊在一起的意思是：我其實是做了一個class ui，重複用了兩個，一個當前景、一個當背景</li>
</ol>
</li>
<li>細節（由大到小分析）：<ol>
<li><img src="layout3.png" alt=""></li>
<li>這裡描述著，每一個刻度，有分有顏色和沒顏色的部分，沒顏色的部分我稱它為：<span style="color:red">Gap</span></li>
</ol>
</li>
</ul>
<h3 id="Canvas"><a href="#Canvas" class="headerlink" title="Canvas"></a>Canvas</h3><p>Android Canvas，當繼承 View 之後，在 onDraw 的 call back 中就會接收到。</p>
<p>只要當View建立完成，或是呼叫了 invaildate()，都會進入 onDraw 方法，用意在於叫開發者自行實作自己想要的結果。我的實作重點就在這個畫布上，它是完成這個UI的最重要的物件。</p>
<p>當然我們一樣先來看一下，下面這張圖：<br><img src="full.png" alt=""></p>
<p>這個樣式就是上面分析時所講到的第二點，三角形裁減區塊沒有使用的時候。</p>
<p>要畫出等級刻度，其實很簡單，使用 drawPath 就可以了，example：（畫一條紅線）</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> paint = Paint()</span><br><span class="line">paint.color = Color.Red</span><br><span class="line"></span><br><span class="line"><span class="keyword">val</span> mPath = Path()</span><br><span class="line">mPath.moveTo(<span class="number">0</span>f, <span class="number">0</span>f)</span><br><span class="line">mPath.lineTo(<span class="number">25</span>f, height.toFloat())</span><br><span class="line">canvas?.drawPath(mPath, paint)</span><br></pre></td></tr></table></figure>
<p>簡單的範例一下，只是說明，要做出等級刻度，使用 canvas.drawPath 即可，這就是實作這個ui layout的第一步。</p>
<h2 id="實作邏輯"><a href="#實作邏輯" class="headerlink" title="實作邏輯"></a>實作邏輯</h2><h3 id="流程"><a href="#流程" class="headerlink" title="流程"></a>流程</h3><p>先來看張流程圖：<br><img src="Flow.png" alt=""></p>
<p>說明一下其中兩大元件：</p>
<ul>
<li>UIVolumeView：我們自行客製化的元件，下面開始慢慢補完程式</li>
<li>SeekBar：Android 的 Slider，用來控制 0 ~ 100 的進度，要demo UIVolumeView 所用</li>
</ul>
<p>流程圖中，SeekBar 接收到改變值，使用 setLevel改變 UIVolumeView的等級，一接收到就 invaildate() 重刷畫面，然後結束。之後反覆循環這個動作，UIVolumeView就會不停變化，<strong>但沒有動畫，動畫效果後面會提到。</strong></p>
<p>流程圖的流程是裁減然後draw但我要講解的順序是反過來的，我會先講 drawPath 再回頭講三角形剪裁，這麼說明的原因其實是因為這裡的裁減邏輯跟原始畫出來的圖會有點關聯，先講解刻度的畫法會對裁減比較有感覺。</p>
<h3 id="依-0-100-的等級畫出刻度"><a href="#依-0-100-的等級畫出刻度" class="headerlink" title="依 0 ~ 100 的等級畫出刻度"></a>依 0 ~ 100 的等級畫出刻度</h3><p>首先，找出刻度和刻度間隙的寬度，也就是每一刻的寬和每一刻中間的白色寬度。通過完成圖分析結果，發現每一刻對間隙，比值是 2:1 寬度，換句話說就是兩個間隙的寬度剛好等於一刻。</p>
<p>就以此規則定義刻度和間隙的寬度吧，但是我們不能寫死寬度的計算，因此要先定義整個主圖層要畫多少刻，建立以下規格：</p>
<ol>
<li>25刻，一刻4%</li>
<li>間隙總共：25 - 1 = 24</li>
<li>套用2:1的規則，25 x 2 + 24 = 74 &lt;—- 74 就是我們要算得的線的結果</li>
</ol>
<p>用圖來詳細拆分一下什麼是 2:1<br><img src="full_detail.png" alt=""></p>
<p>那為什麼要用這種分法呢？ 因為我這裡畫線的邏輯是用x跳格，然後一條線的寬度是 (view.width / 74 ) * 2 之後畫一條直線到 view.height 也就是最底部的 y。</p>
<p>一樣用圖來解說：<br><img src="Flow2.png" alt=""></p>
<p>先宣告幾個 property，然後寫一下 init 方法，讓畫筆有預設顏色：</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//初始化設定</span></span><br><span class="line">    init &#123;</span><br><span class="line">        paint.color = Color.BLUE</span><br><span class="line">        paint.style = Paint.Style.FILL_AND_STROKE</span><br><span class="line">        paint.isAntiAlias = <span class="literal">true</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//可指定漸層色</span></span><br><span class="line">    <span class="keyword">var</span> paintShader: Shader? = <span class="literal">null</span></span><br><span class="line">        <span class="keyword">set</span>(value) &#123;</span><br><span class="line">            field = value</span><br><span class="line">            paint.shader = value</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//一般顏色</span></span><br><span class="line">    <span class="keyword">var</span> paintColor: <span class="built_in">Int</span>? = <span class="literal">null</span></span><br><span class="line">        <span class="keyword">set</span>(value) &#123;</span><br><span class="line">            <span class="keyword">val</span> colorInt = value ?: <span class="keyword">return</span></span><br><span class="line">            field = value</span><br><span class="line">            paint.color = colorInt</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> level: <span class="built_in">Int</span> = <span class="number">0</span></span><br><span class="line">        <span class="keyword">set</span>(value) &#123;</span><br><span class="line">            <span class="keyword">if</span> (value <span class="keyword">in</span> <span class="number">0.</span><span class="number">.100</span>) &#123;</span><br><span class="line">                field = value</span><br><span class="line">                postInvalidate()</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure>
<p>level 這裡使用了blocking field，限定0到100才可以加入，然後接著寫 for loop 畫線的核心程式碼：</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//current 跟著 0 ~ 100 的 level 在畫線的時候要/4，因為這樣畫刻度的次數才是正確的</span></span><br><span class="line">   <span class="keyword">private</span> <span class="function"><span class="keyword">fun</span> <span class="title">drawAll</span><span class="params">(canvas: <span class="type">Canvas</span>?)</span></span> &#123;</span><br><span class="line">       path.reset()</span><br><span class="line"></span><br><span class="line">       <span class="keyword">val</span> avgWidth = width / <span class="number">74</span></span><br><span class="line">       <span class="keyword">val</span> oneScaleWidth = avgWidth * <span class="number">2</span></span><br><span class="line">       <span class="keyword">val</span> oneGapWidth = avgWidth</span><br><span class="line">       paint.strokeWidth = oneScaleWidth.toFloat()</span><br><span class="line"></span><br><span class="line">       <span class="keyword">for</span> (i <span class="keyword">in</span> <span class="number">0</span> until level step <span class="number">4</span>) &#123;</span><br><span class="line">           <span class="keyword">val</span> mPath = Path()</span><br><span class="line">           <span class="keyword">val</span> x = (avgWidth * <span class="number">3</span>) * (i / <span class="number">4</span>).toFloat()</span><br><span class="line"></span><br><span class="line">           <span class="comment">//總共25條，每條佔4%, 循環畫出</span></span><br><span class="line">           mPath.moveTo(x, <span class="number">0</span>f)</span><br><span class="line">           mPath.lineTo(x, height.toFloat())</span><br><span class="line">           path.addPath(mPath)</span><br><span class="line">       &#125;</span><br><span class="line"></span><br><span class="line">       canvas?.drawPath(path, paint)</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<ol>
<li><p>path 是 class 全域變數，每次 onDraw 都 reset 重建</p>
</li>
<li><p>每次 loop 都把建好的 path 串起來</p>
</li>
<li><p>最後使用 drawPath畫出，一次畫比較省力</p>
</li>
</ol>
</blockquote>
<p>從這裡就可以看到 for loop中，移動 x 時的計算，x 的移動其實是每次移動三格，除以四是為了畫出25刻，等於每四級畫一刻，不過這段程式碼中做了一個判斷，就是 i 只 loop 到 level，因為level是動態給予的，所以每次畫都只畫到level為止。(當然，level = 100 ，就畫到滿)</p>
<p>接著把這段程式碼複製貼上到 UIVolumeView裡，完成此一階段。如果想先看到結果，也可以在 onDraw 的地方，呼叫這個fun，就會看到沒有裁減的結果了！</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onDraw</span><span class="params">(canvas: <span class="type">Canvas</span>?)</span></span> &#123;</span><br><span class="line">       <span class="keyword">super</span>.onDraw(canvas)</span><br><span class="line">       drawAll(canvas)</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>
<h3 id="剪裁三角形"><a href="#剪裁三角形" class="headerlink" title="剪裁三角形"></a>剪裁三角形</h3><p>接著來說明一下，為何要裁減三角形。如果你有先把level隨意設定一下，然後執行 drawAll() 看看效果，你會得到一個正方形的刻度顯示，此時就要開始思考，要如何才能得到下面這個最後的結果？</p>
<p><img src="layout1.png" alt=""></p>
<p>這個無法切圖，但我們可以剪裁，Canvas都有剪裁的功能可以使用。剪裁的概念範圍很大，在這裡僅使用 clipPath 做說明，其他的用法不是很了解，所以也不多做說明。</p>
<p>首先，先說明clip 剪裁是剪裁出新畫布，也就是說：<strong>剪出來的區域是可以看得到的區域，要記得這個規則！</strong>，拿下圖來說明，我畫了一個全紅色的正方形，我對中間剪了一個正方形出來，會是這樣顯示：</p>
<p><img src="Shape.png" alt=""></p>
<p>剪裁後，白色的部分都變成是顯示不出來的區域，只有裁出來的那塊區域才能顯示紅色！</p>
<p>所以，如果我們想剪裁出完成品，並不是剪裁三角形，而是剪裁一個不規則的四邊形，這也是為什麼我是使用 clipPath 的主要原因，一樣使用圖解來解說！</p>
<p>圖中黑色的線，就是圈起來想要剪掉的區塊：<br><img src="Shape2.png" alt=""></p>
<p>那為什麼這裡所說的是剪裁三角形，而不是剪裁不規則四邊形呢？其實因為以圖層來看，人正常的思考邏輯其實是剪裁三角形，白話的說是我圈出一個區域，這個區域是我不要的。</p>
<p>而clipPath是圈出一個區域，這個區域是我要的。在實作的時候有看到 clipOutPath這個方法，但是這個方式是 API 26 才加入的，<br>有可能這個的使用方式就是反過來的，不深究囉。</p>
<p>剪裁邏輯，就直接看code，只是圈了四個點，然後形成一個四邊形之後剪裁而已：</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//每次都剪裁三角形，這樣可以維持 postInvalidateDelayed 的動畫效果</span></span><br><span class="line">       <span class="keyword">val</span> pathClip = Path()</span><br><span class="line">       pathClip.moveTo(width.toFloat(), height.toFloat())</span><br><span class="line">       pathClip.lineTo(<span class="number">0</span>f, height.toFloat())</span><br><span class="line">       pathClip.lineTo(<span class="number">0</span>f, height.toFloat() * <span class="number">0.9</span>f)</span><br><span class="line">       pathClip.lineTo(width.toFloat(), <span class="number">0</span>f)</span><br><span class="line">       canvas?.clipPath(pathClip)</span><br></pre></td></tr></table></figure>
<p>把這段程式碼放到 onDraw() , drawAll之前，像以下：</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onDraw</span><span class="params">(canvas: <span class="type">Canvas</span>?)</span></span> &#123;</span><br><span class="line">      <span class="keyword">super</span>.onDraw(canvas)</span><br><span class="line"></span><br><span class="line">      <span class="comment">//每次都剪裁三角形，這樣可以維持 postInvalidate 的動畫效果</span></span><br><span class="line">      <span class="keyword">val</span> pathClip = Path()</span><br><span class="line">      pathClip.moveTo(width.toFloat(), height.toFloat())</span><br><span class="line">      pathClip.lineTo(<span class="number">0</span>f, height.toFloat())</span><br><span class="line">      pathClip.lineTo(<span class="number">0</span>f, height.toFloat() * <span class="number">0.9</span>f)</span><br><span class="line">      pathClip.lineTo(width.toFloat(), <span class="number">0</span>f)</span><br><span class="line">      canvas?.clipPath(pathClip)</span><br><span class="line"></span><br><span class="line">      drawAll(canvas)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="動畫效果"><a href="#動畫效果" class="headerlink" title="動畫效果"></a>動畫效果</h3><p>這個效果當初弄了很久，嘗試了很多笨方法，包括直接hard code寫了一大堆邏輯，還是使用了 postInvaildateDealy 不斷重複呼叫，都覺得很複雜。</p>
<p>思考了幾天，終於找到一個很適合的方法，就是使用 ObjectAnimator。</p>
<p>ObjectAnimator 的底層原理呢，我也不知道，這裡簡單說明比較淺的概念。ObjectAnimator 繼承 ValueAnimator，增進其用法，可以直接使用屬性名稱，進行動畫變化，算是一個滿快速上手的API。</p>
<p>依循這個原則，我嘗試將level當成是 ObjectAnimator 內可以映射的屬性，發現確實可以這麼使用，原來 ObjectAnimator 會根據設定好的參數、插值器，重複呼叫class 中的 setter，以這個UIVolumeView來說，就是不斷的呼叫 setLevel。</p>
<p>然後我在 setLevel (因為是kt，其實程式碼已經寫在field下面了)，不斷使用 postInvalidate：</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> level: <span class="built_in">Int</span> = <span class="number">0</span> </span><br><span class="line">	<span class="keyword">set</span>(value) &#123;</span><br><span class="line">      <span class="keyword">if</span> (value <span class="keyword">in</span> <span class="number">0.</span><span class="number">.100</span>) &#123;</span><br><span class="line">    		 field = value</span><br><span class="line">    		 postInvalidate()</span><br><span class="line">	   &#125;</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>
<p>如此作法，就會引發 onDraw 重複呼叫，像是一幀幀的動畫執行一樣很 smooth ~，ObjectAnimator 應該是管理了這個 level 屬性值，如果快速重複呼叫，也不會有卡頓的動畫感，而是快速增加又快速減少，通過 log 我就有發現，當 slider 快速的拉大拉小時，這個 setLevel 呼叫的時機點順序執行。</p>
<p>在 UIVolumeView 裡建立一個public fun，提供給外部呼叫：</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">animateLevel</span><span class="params">(level: <span class="type">Int</span>)</span></span> &#123;</span><br><span class="line">	<span class="keyword">val</span> objectAnimator = ObjectAnimator.ofInt(<span class="keyword">this</span>, <span class="string">"level"</span>, level)</span><br><span class="line">   	objectAnimator.duration = <span class="number">250</span></span><br><span class="line"> 	objectAnimator.interpolator = DecelerateInterpolator()</span><br><span class="line">	objectAnimator.start()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>然後整個class 完成，就會像以下：</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">UIVolumeView</span> : <span class="type">View &#123;</span></span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">val</span> paint = Paint()</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">val</span> path = Path()</span><br><span class="line"></span><br><span class="line">    <span class="comment">//初始化設定</span></span><br><span class="line">    init &#123;</span><br><span class="line">        paint.color = Color.BLUE</span><br><span class="line">        paint.style = Paint.Style.FILL_AND_STROKE</span><br><span class="line">        paint.isAntiAlias = <span class="literal">true</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//可指定漸層色</span></span><br><span class="line">    <span class="keyword">var</span> paintShader: Shader? = <span class="literal">null</span></span><br><span class="line">        <span class="keyword">set</span>(value) &#123;</span><br><span class="line">            field = value</span><br><span class="line">            paint.shader = value</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//一般顏色</span></span><br><span class="line">    <span class="keyword">var</span> paintColor: <span class="built_in">Int</span>? = <span class="literal">null</span></span><br><span class="line">        <span class="keyword">set</span>(value) &#123;</span><br><span class="line">            <span class="keyword">val</span> colorInt = value ?: <span class="keyword">return</span></span><br><span class="line">            field = value</span><br><span class="line">            paint.color = colorInt</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> level: <span class="built_in">Int</span> = <span class="number">0</span></span><br><span class="line">        <span class="keyword">set</span>(value) &#123;</span><br><span class="line">            <span class="keyword">if</span> (value <span class="keyword">in</span> <span class="number">0.</span><span class="number">.100</span>) &#123;</span><br><span class="line">                field = value</span><br><span class="line">                postInvalidate()</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">constructor</span>(context: Context?) : <span class="keyword">super</span>(context)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">constructor</span>(context: Context?, attrs: AttributeSet?) : <span class="keyword">super</span>(context, attrs)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">constructor</span>(context: Context?, attrs: AttributeSet?, defStyleAttr: <span class="built_in">Int</span>) : <span class="keyword">super</span>(context, attrs, defStyleAttr)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">constructor</span>(context: Context?, attrs: AttributeSet?, defStyleAttr: <span class="built_in">Int</span>, defStyleRes: <span class="built_in">Int</span>) : <span class="keyword">super</span>(context, attrs, defStyleAttr, defStyleRes)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onDraw</span><span class="params">(canvas: <span class="type">Canvas</span>?)</span></span> &#123;</span><br><span class="line">        <span class="keyword">super</span>.onDraw(canvas)</span><br><span class="line"></span><br><span class="line">        <span class="comment">//每次都剪裁三角形，這樣可以維持 postInvalidateDelayed</span></span><br><span class="line">        <span class="keyword">val</span> pathClip = Path()</span><br><span class="line">        pathClip.moveTo(width.toFloat(), height.toFloat())</span><br><span class="line">        pathClip.lineTo(<span class="number">0</span>f, height.toFloat())</span><br><span class="line">        pathClip.lineTo(<span class="number">0</span>f, height.toFloat() * <span class="number">0.9</span>f)</span><br><span class="line">        pathClip.lineTo(width.toFloat(), <span class="number">0</span>f)</span><br><span class="line">        canvas?.clipPath(pathClip)</span><br><span class="line"></span><br><span class="line">        drawAll(canvas)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">animateLevel</span><span class="params">(level: <span class="type">Int</span>)</span></span> &#123;</span><br><span class="line">        <span class="keyword">val</span> objectAnimator = ObjectAnimator.ofInt(<span class="keyword">this</span>, <span class="string">"level"</span>, level)</span><br><span class="line">        objectAnimator.duration = <span class="number">250</span></span><br><span class="line">        objectAnimator.interpolator = DecelerateInterpolator()</span><br><span class="line">        objectAnimator.start()</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//current 跟著 0 ~ 100 的 level 在畫線的時候要/4，因為這樣畫刻度的次數才是正確的</span></span><br><span class="line">    <span class="keyword">private</span> <span class="function"><span class="keyword">fun</span> <span class="title">drawAll</span><span class="params">(canvas: <span class="type">Canvas</span>?)</span></span> &#123;</span><br><span class="line">        path.reset()</span><br><span class="line"></span><br><span class="line">        <span class="keyword">val</span> avgWidth = width / <span class="number">74</span></span><br><span class="line">        <span class="keyword">val</span> oneScaleWidth = avgWidth * <span class="number">2</span></span><br><span class="line">        paint.strokeWidth = oneScaleWidth.toFloat()</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (i <span class="keyword">in</span> <span class="number">0</span> until level step <span class="number">4</span>) &#123;</span><br><span class="line">            <span class="keyword">val</span> mPath = Path()</span><br><span class="line">            <span class="keyword">val</span> x = (avgWidth * <span class="number">3</span>) * (i / <span class="number">4</span>).toFloat()</span><br><span class="line"></span><br><span class="line">            <span class="comment">//總共25條，每條佔4%, 循環畫出</span></span><br><span class="line">            mPath.moveTo(x, <span class="number">0</span>f)</span><br><span class="line">            mPath.lineTo(x, height.toFloat())</span><br><span class="line">            path.addPath(mPath)</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        canvas?.drawPath(path, paint)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="UI-Layout"><a href="#UI-Layout" class="headerlink" title="UI Layout"></a>UI Layout</h3><p>打開 activtiy_main.xml，直接貼上，<strong>ui的class package 記得更改！</strong></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span><br><span class="line"><span class="tag">&lt;<span class="name">android.support.constraint.ConstraintLayout</span> <span class="attr">xmlns:android</span>=<span class="string">"http://schemas.android.com/apk/res/android"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:app</span>=<span class="string">"http://schemas.android.com/apk/res-auto"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:tools</span>=<span class="string">"http://schemas.android.com/tools"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_height</span>=<span class="string">"match_parent"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">tools:context</span>=<span class="string">".MainActivity"</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">UIVolumeView</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:id</span>=<span class="string">"@+id/volumeBackScale"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_width</span>=<span class="string">"250dp"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_height</span>=<span class="string">"70dp"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_marginEnd</span>=<span class="string">"16dp"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_marginStart</span>=<span class="string">"16dp"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_marginTop</span>=<span class="string">"180dp"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">app:layout_constraintEnd_toEndOf</span>=<span class="string">"parent"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">app:layout_constraintHorizontal_bias</span>=<span class="string">"0.5"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">app:layout_constraintStart_toStartOf</span>=<span class="string">"parent"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">app:layout_constraintTop_toTopOf</span>=<span class="string">"parent"</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">UIVolumeView</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:id</span>=<span class="string">"@+id/volume"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_width</span>=<span class="string">"250dp"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_height</span>=<span class="string">"70dp"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_marginEnd</span>=<span class="string">"16dp"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_marginStart</span>=<span class="string">"16dp"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_marginTop</span>=<span class="string">"180dp"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">app:layout_constraintEnd_toEndOf</span>=<span class="string">"parent"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">app:layout_constraintHorizontal_bias</span>=<span class="string">"0.5"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">app:layout_constraintStart_toStartOf</span>=<span class="string">"parent"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">app:layout_constraintTop_toTopOf</span>=<span class="string">"parent"</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">SeekBar</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:id</span>=<span class="string">"@+id/slider"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_height</span>=<span class="string">"50dp"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_marginBottom</span>=<span class="string">"8dp"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_marginEnd</span>=<span class="string">"16dp"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_marginStart</span>=<span class="string">"16dp"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_marginTop</span>=<span class="string">"8dp"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">app:layout_constraintBottom_toTopOf</span>=<span class="string">"@+id/volume"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">app:layout_constraintEnd_toEndOf</span>=<span class="string">"parent"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">app:layout_constraintStart_toStartOf</span>=<span class="string">"parent"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">app:layout_constraintTop_toTopOf</span>=<span class="string">"parent"</span> /&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">android.support.constraint.ConstraintLayout</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>打開 MainActivtiy或隨便你要放UI的 Activtiy都行，貼上以下實作程式碼：</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//這個view 就是要來輸出等級的view</span></span><br><span class="line">   <span class="keyword">private</span> <span class="keyword">lateinit</span> <span class="keyword">var</span> volume: UIVolumeView</span><br><span class="line"></span><br><span class="line">   <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onCreate</span><span class="params">(savedInstanceState: <span class="type">Bundle</span>?)</span></span> &#123;</span><br><span class="line">       <span class="keyword">super</span>.onCreate(savedInstanceState)</span><br><span class="line">       setContentView(R.layout.activity_main)</span><br><span class="line"></span><br><span class="line">       <span class="keyword">val</span> backScale = findViewById&lt;UIVolumeView&gt;(R.id.volumeBackScale)</span><br><span class="line">       backScale.paintColor = Color.parseColor(<span class="string">"#757F9A"</span>)</span><br><span class="line">       backScale.level = <span class="number">100</span></span><br><span class="line"></span><br><span class="line">       <span class="comment">//設置漸層色</span></span><br><span class="line">       volume = findViewById(R.id.volume)</span><br><span class="line"></span><br><span class="line">       findViewById&lt;SeekBar&gt;(R.id.slider).setOnSeekBarChangeListener(<span class="keyword">object</span> : SeekBar.OnSeekBarChangeListener &#123;</span><br><span class="line">           <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onProgressChanged</span><span class="params">(p0: <span class="type">SeekBar</span>?, p1: <span class="type">Int</span>, p2: <span class="type">Boolean</span>)</span></span> &#123;</span><br><span class="line">           		<span class="comment">// 每次呼叫</span></span><br><span class="line">               volume.animateLevel(p1)</span><br><span class="line">           &#125;</span><br><span class="line"></span><br><span class="line">           <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onStartTrackingTouch</span><span class="params">(p0: <span class="type">SeekBar</span>?)</span></span> &#123;</span><br><span class="line">           &#125;</span><br><span class="line"></span><br><span class="line">           <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onStopTrackingTouch</span><span class="params">(p0: <span class="type">SeekBar</span>?)</span></span> &#123;</span><br><span class="line">           &#125;</span><br><span class="line"></span><br><span class="line">       &#125;)</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onWindowFocusChanged</span><span class="params">(hasFocus: <span class="type">Boolean</span>)</span></span> &#123;</span><br><span class="line">       <span class="keyword">super</span>.onWindowFocusChanged(hasFocus)</span><br><span class="line"></span><br><span class="line">       <span class="keyword">if</span> (hasFocus) &#123;</span><br><span class="line">           <span class="comment">//漸層色設定，水平方向渲染</span></span><br><span class="line">           volume.paintShader = LinearGradient(<span class="number">0</span>f, <span class="number">0</span>f, volume.width.toFloat(), <span class="number">0</span>f, intArrayOf(Color.parseColor(<span class="string">"#1E9600"</span>), Color.parseColor(<span class="string">"#FFF200"</span>), Color.parseColor(<span class="string">"#FF0000"</span>)), floatArrayOf(<span class="number">0</span>f, <span class="number">0.5</span>f, <span class="number">1</span>f), Shader.TileMode.REPEAT)</span><br><span class="line">       &#125;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>val backScale = findViewById<uivolumeview>(R.id.volumeBackScale)</uivolumeview></p>
<blockquote>
<p>用來當底圖</p>
</blockquote>
</blockquote>
<blockquote>
<p>backScale.level = 100</p>
<blockquote>
<p>直接設定 100% , 輸出淺灰色的刻度</p>
</blockquote>
</blockquote>
<blockquote>
<p>onWindowFocusChanged</p>
<blockquote>
<p>當hasFocus的時候 UIVolumeView 才會有真正的 width，用該width 對 volume 設定漸層色，要不要設定隨便，總之就比較好看</p>
</blockquote>
</blockquote>
<p>以上，就全部都完成了一開始我們想要達成的UI效果，希望大家看得到效果！！</p>

      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2018/08/30/Android-Camera2-Guide/" rel="prev" title="Android Camera2 API 錄影開發歷程 (一)">
                Android Camera2 API 錄影開發歷程 (一) <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            文章目錄
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            本站概覽
          </li>
        </ul>
      

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name">Lex</p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">4</span>
                  <span class="site-state-item-name">文章</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                <a href="/categories/index.html">
                  <span class="site-state-item-count">1</span>
                  <span class="site-state-item-name">分類</span>
                </a>
              </div>
            

            

          </nav>

          

          
            <div class="links-of-author motion-element">
                
                  <span class="links-of-author-item">
                    <a href="https://github.com/vampire1514" target="_blank" title="GitHub">
                      
                        <i class="fa fa-fw fa-github"></i>GitHub</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="wmliy343@gmail.com" target="_blank" title="E-Mail">
                      
                        <i class="fa fa-fw fa-envelope"></i>E-Mail</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="https://www.facebook.com/wang.lex.5" target="_blank" title="FB Page">
                      
                        <i class="fa fa-fw fa-facebook"></i>FB Page</a>
                  </span>
                
            </div>
          

          
          

          
          

          

        </div>
      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#Android-Studio-環境配置"><span class="nav-number">1.</span> <span class="nav-text">Android Studio 環境配置</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#程度需求"><span class="nav-number">2.</span> <span class="nav-text">程度需求</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#完成效果"><span class="nav-number">3.</span> <span class="nav-text">完成效果</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#正式開始"><span class="nav-number">4.</span> <span class="nav-text">正式開始</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#開始吧！-首先："><span class="nav-number">4.1.</span> <span class="nav-text">開始吧！ 首先：</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#UI-設計概念"><span class="nav-number">5.</span> <span class="nav-text">UI 設計概念</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#前言"><span class="nav-number">5.1.</span> <span class="nav-text">前言</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#分析"><span class="nav-number">5.2.</span> <span class="nav-text">分析</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Canvas"><span class="nav-number">5.3.</span> <span class="nav-text">Canvas</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#實作邏輯"><span class="nav-number">6.</span> <span class="nav-text">實作邏輯</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#流程"><span class="nav-number">6.1.</span> <span class="nav-text">流程</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#依-0-100-的等級畫出刻度"><span class="nav-number">6.2.</span> <span class="nav-text">依 0 ~ 100 的等級畫出刻度</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#剪裁三角形"><span class="nav-number">6.3.</span> <span class="nav-text">剪裁三角形</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#動畫效果"><span class="nav-number">6.4.</span> <span class="nav-text">動畫效果</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#UI-Layout"><span class="nav-number">6.5.</span> <span class="nav-text">UI Layout</span></a></li></ol></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; 2011 &mdash; <span itemprop="copyrightYear">2018</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Lex</span>

  
</div>


  <div class="powered-by">由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 強力驅動</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主題 &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Pisces</a> v5.1.4</div>




        
<div class="busuanzi-count">
  <script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>

  
    <span class="site-uv">
      <i class="fa fa-user">訪客人數</i>
      <span class="busuanzi-value" id="busuanzi_value_site_uv"></span>
      
    </span>
  

  
    <span class="site-pv">
      <i class="fa fa-eye">閱讀次數</i>
      <span class="busuanzi-value" id="busuanzi_value_site_pv"></span>
      
    </span>
  
</div>








        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.4"></script>



  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.4"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.4"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  





  

  

  

  
  

  

  

  

</body>
</html>
